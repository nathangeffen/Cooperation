<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Prisoner&#39;s Dilemna: /home/nathan/workspace/cooperation/mainwindow.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Prisoner's Dilemna&#160;<span id="projectnumber">0.1</span></div>
   <div id="projectbrief">Implementation of Prisoner's Dilemna game with several competitors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('mainwindow_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/nathan/workspace/cooperation/mainwindow.cpp</div>  </div>
</div>
<div class="contents">
<a href="mainwindow_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;exception&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;QtGui&gt;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="guiplay_8h.html">guiplay.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="mainwindow_8h.html">mainwindow.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="definegamedialog_8h.html">definegamedialog.h</a>&quot;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="keyword">using namespace </span>std;
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="class_main_window.html#ac97b2dbf0bcea3618287c8becbae4c14">00017</a> <a class="code" href="class_main_window.html#ac97b2dbf0bcea3618287c8becbae4c14">MainWindow::MainWindow</a>(<a class="code" href="class_game.html">Game</a>&amp; game) : game_(game)
<a name="l00018"></a>00018 {
<a name="l00019"></a>00019   setWindowTitle( tr(<span class="stringliteral">&quot;Prisoner&#39;s Dilemna&quot;</span>) );
<a name="l00020"></a>00020 
<a name="l00021"></a>00021   updateFrequency_ = 1;
<a name="l00022"></a>00022   displayMethodology_ = <a class="code" href="guicommon_8h.html#ab73f4a618a1a86d78e9cc82ff1c376dfae414611317e3e0a04e7702e077758948">RANK</a>;
<a name="l00023"></a>00023   timer_ = 0;
<a name="l00024"></a>00024   firstTime_ = <span class="keyword">true</span>;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   QWidget *topFiller = <span class="keyword">new</span> QWidget;
<a name="l00027"></a>00027   topFiller-&gt;setSizePolicy(QSizePolicy::Maximum, QSizePolicy::Maximum);
<a name="l00028"></a>00028 
<a name="l00029"></a>00029   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Welcome to the Prisoner&#39;s Dilemna game&quot;</span>));
<a name="l00030"></a>00030 
<a name="l00031"></a>00031   uint colorStep = 0xFFFFFF / <a class="code" href="competitor_8cpp.html#aba6d589a9574e301dd63b49cac128d6d">registeredCompetitors</a>.size();
<a name="l00032"></a>00032   uint i = 0;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034   <span class="keywordflow">for</span> ( <span class="keyword">auto</span> c : <a class="code" href="competitor_8cpp.html#aba6d589a9574e301dd63b49cac128d6d">registeredCompetitors</a> ) {
<a name="l00035"></a>00035     colors_[c.first] = QColor(<span class="stringliteral">&quot;#&quot;</span> + QString::number(i, 16).rightJustified(6, <span class="charliteral">&#39;0&#39;</span>));
<a name="l00036"></a>00036     i += colorStep;
<a name="l00037"></a>00037   }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039   this-&gt;menuBar()-&gt;setVisible( <span class="keyword">false</span> );
<a name="l00040"></a>00040 
<a name="l00041"></a>00041   inProgress_ = <span class="keyword">false</span>;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="comment">// Set up the toolbar, the actions on it and the icons for those actions</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   setupToolBar();
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   QWidget* widget = <span class="keyword">new</span> QWidget;
<a name="l00048"></a>00048   setCentralWidget( widget );
<a name="l00049"></a>00049   guiPlay_ = 0;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051   this-&gt;setSizePolicy(QSizePolicy::Maximum, QSizePolicy::Maximum);
<a name="l00052"></a>00052   setMinimumSize(160, 160);
<a name="l00053"></a>00053   resize(480, 320);
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="keywordtype">void</span> MainWindow::setupToolBar()
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058   toolBar_ = <span class="keyword">new</span> QToolBar( <span class="keyword">this</span> );
<a name="l00059"></a>00059 
<a name="l00060"></a>00060   openGamePixmap_ = <span class="keyword">new</span> QPixmap( <span class="stringliteral">&quot;:/icons/open&quot;</span> );
<a name="l00061"></a>00061   saveGamePixmap_ = <span class="keyword">new</span> QPixmap( <span class="stringliteral">&quot;:/icons/savegame&quot;</span> );
<a name="l00062"></a>00062   newGamePixmap_ = <span class="keyword">new</span> QPixmap( <span class="stringliteral">&quot;:/icons/new&quot;</span> );
<a name="l00063"></a>00063   playPixmap_ = <span class="keyword">new</span> QPixmap( <span class="stringliteral">&quot;:/icons/play&quot;</span> );
<a name="l00064"></a>00064   pausePixmap_ = <span class="keyword">new</span> QPixmap( <span class="stringliteral">&quot;:/icons/pause&quot;</span>);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   openGameIcon_ = <span class="keyword">new</span> QIcon( *openGamePixmap_ );
<a name="l00067"></a>00067   saveGameIcon_ = <span class="keyword">new</span> QIcon( *saveGamePixmap_ );
<a name="l00068"></a>00068   newGameIcon_ = <span class="keyword">new</span> QIcon( *newGamePixmap_ );
<a name="l00069"></a>00069   playIcon_ = <span class="keyword">new</span> QIcon( *playPixmap_ );
<a name="l00070"></a>00070   pauseIcon_ = <span class="keyword">new</span> QIcon( *pausePixmap_ );
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   openGameAction_ = <span class="keyword">new</span> QAction( *openGameIcon_, QString(tr(<span class="stringliteral">&quot;Open&quot;</span>)), <span class="keyword">this</span> );
<a name="l00073"></a>00073   openGameAction_-&gt;setShortcut( QKeySequence::Open );
<a name="l00074"></a>00074   connect( openGameAction_, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(openGameDefinition() ) );
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   saveGameAction_ = <span class="keyword">new</span> QAction( *saveGameIcon_, QString(tr(<span class="stringliteral">&quot;Save game&quot;</span>)), <span class="keyword">this</span> );
<a name="l00077"></a>00077   saveGameAction_-&gt;setShortcut( QKeySequence::Save );
<a name="l00078"></a>00078   saveGameAction_-&gt;setDisabled( <span class="keyword">true</span> );
<a name="l00079"></a>00079   connect( saveGameAction_, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(saveGameDefinition() ) );
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   newGameAction_ = <span class="keyword">new</span> QAction( *newGameIcon_, QString(tr(<span class="stringliteral">&quot;New game&quot;</span>)), <span class="keyword">this</span>);
<a name="l00082"></a>00082   newGameAction_-&gt;setShortcut( QKeySequence::New );
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   playAction_ = <span class="keyword">new</span> QAction( *playIcon_, QString(tr(<span class="stringliteral">&quot;Play&quot;</span>)), <span class="keyword">this</span> );
<a name="l00085"></a>00085   playAction_-&gt;setShortcut( QKeySequence( <span class="stringliteral">&quot;CTRL+P&quot;</span>) );
<a name="l00086"></a>00086   playAction_-&gt;setDisabled( <span class="keyword">true</span> );
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   toolBar_-&gt;addAction( newGameAction_ );
<a name="l00089"></a>00089   toolBar_-&gt;addAction( openGameAction_ );
<a name="l00090"></a>00090   toolBar_-&gt;addAction( saveGameAction_ );
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   connect( newGameAction_, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(newGameDialog()) );
<a name="l00093"></a>00093   toolBar_-&gt;addAction( playAction_ );
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   addToolBar( toolBar_ );
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="keywordtype">void</span> MainWindow::drawGameGrid()
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100   <span class="keywordflow">if</span> ( game_.<a class="code" href="class_game.html#ab5f306bb166999e63e2ee05e0bbaacd5">getNumberCompetitors</a>() == 0 ) <span class="keywordflow">return</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   <span class="keywordflow">if</span> ( guiPlay_ )
<a name="l00103"></a>00103     <span class="keyword">delete</span> guiPlay_;
<a name="l00104"></a>00104   <span class="keywordflow">else</span>
<a name="l00105"></a>00105     connect(playAction_, SIGNAL(triggered() ), <span class="keyword">this</span>, SLOT(executeGame() ) );
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   playAction_-&gt;setEnabled( <span class="keyword">true</span> );
<a name="l00108"></a>00108   playAction_-&gt;setEnabled(<span class="keyword">true</span>);
<a name="l00109"></a>00109   guiPlay_ = <span class="keyword">new</span> <a class="code" href="class_gui_play.html">GuiPlay</a>( game_, displayMethodology_, timer_,
<a name="l00110"></a>00110                           updateFrequency_, colors_, <span class="keyword">this</span> );
<a name="l00111"></a>00111   connect(guiPlay_, SIGNAL( stopPlaying() ), <span class="keyword">this</span>, SLOT(stopPlaying() ) );
<a name="l00112"></a>00112   setCentralWidget( guiPlay_ );
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="keywordtype">void</span> MainWindow::saveGameDefinition()
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118   <span class="keywordflow">if</span> ( firstTime_ )
<a name="l00119"></a>00119     <span class="keywordflow">return</span>;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   QString filename;
<a name="l00122"></a>00122   <span class="keywordflow">try</span> {
<a name="l00123"></a>00123     QFileDialog dialog( <span class="keyword">this</span> );
<a name="l00124"></a>00124     dialog.setFileMode( QFileDialog::AnyFile );
<a name="l00125"></a>00125     dialog.setDefaultSuffix( QString(<span class="stringliteral">&quot;pdi&quot;</span>) );
<a name="l00126"></a>00126     dialog.setAcceptMode( QFileDialog::AcceptSave );
<a name="l00127"></a>00127     dialog.setNameFilters( QStringList(QString(<span class="stringliteral">&quot;Game files (*.pdi)&quot;</span>)) );
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="keywordflow">if</span> ( dialog.exec() ) {
<a name="l00130"></a>00130       filename = dialog.selectedFiles()[0];
<a name="l00131"></a>00131       ofstream out;
<a name="l00132"></a>00132       out.exceptions(ios::failbit);
<a name="l00133"></a>00133       out.open( filename.toStdString() );
<a name="l00134"></a>00134       out &lt;&lt; <span class="stringliteral">&quot;numbercompetitors &quot;</span>;
<a name="l00135"></a>00135       out &lt;&lt; game_.<a class="code" href="class_game.html#a658a753770db51eca96fb822d680c338">getNumberCompetitorsPerCompetitor</a>().size();
<a name="l00136"></a>00136       <span class="keywordflow">for</span> ( <span class="keyword">auto</span> nCompetitors : game_.<a class="code" href="class_game.html#a658a753770db51eca96fb822d680c338">getNumberCompetitorsPerCompetitor</a>() )
<a name="l00137"></a>00137         out &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nCompetitors.first.toStdString() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>
<a name="l00138"></a>00138             &lt;&lt; nCompetitors.second;
<a name="l00139"></a>00139       out &lt;&lt; endl;
<a name="l00140"></a>00140       out &lt;&lt; <span class="stringliteral">&quot;iterations &quot;</span> &lt;&lt; game_.<a class="code" href="class_game.html#adc07928f26c664cefc2c6abee7846d5e">getIterations</a>() &lt;&lt; endl;
<a name="l00141"></a>00141       out &lt;&lt; <span class="stringliteral">&quot;randomseed &quot;</span> &lt;&lt; game_.<a class="code" href="class_game.html#a6e7fe9dda89a2ab47530fbeac087c8be">getRandomSeed</a>() &lt;&lt; endl;
<a name="l00142"></a>00142       out &lt;&lt; <span class="stringliteral">&quot;updatefrequency &quot;</span> &lt;&lt; updateFrequency_ &lt;&lt; endl;
<a name="l00143"></a>00143       out &lt;&lt; <span class="stringliteral">&quot;displaymethodology &quot;</span> &lt;&lt; displayMethodology_ &lt;&lt; endl;
<a name="l00144"></a>00144       out &lt;&lt; <span class="stringliteral">&quot;competitorcolors &quot;</span>;
<a name="l00145"></a>00145       <span class="keywordflow">for</span> ( <span class="keyword">auto</span> color : colors_ )
<a name="l00146"></a>00146         out &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; color.first.toStdString() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>
<a name="l00147"></a>00147             &lt;&lt; color.second.name().toStdString();
<a name="l00148"></a>00148       out &lt;&lt; endl;
<a name="l00149"></a>00149       out &lt;&lt; <span class="stringliteral">&quot;timer &quot;</span> &lt;&lt; timer_ &lt;&lt; endl;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151       out.close();
<a name="l00152"></a>00152       QMessageBox msgBox;
<a name="l00153"></a>00153       msgBox.setText( tr(<span class="stringliteral">&quot;File successfully saved&quot;</span>) );
<a name="l00154"></a>00154       msgBox.exec();
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156   } <span class="keywordflow">catch</span> (exception &amp;e) {
<a name="l00157"></a>00157     QMessageBox msgBox;
<a name="l00158"></a>00158     msgBox.setText( tr(<span class="stringliteral">&quot;Error writing to file: &quot;</span> ) +
<a name="l00159"></a>00159                     QString( filename ) + QString(<span class="stringliteral">&quot;\n&quot;</span>) );
<a name="l00160"></a>00160     msgBox.exec();
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 <span class="keywordtype">void</span> MainWindow::openGameDefinition()
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166   QString filename;
<a name="l00167"></a>00167   <span class="keywordtype">int</span> value, nCompetitors;
<a name="l00168"></a>00168   <span class="keywordflow">try</span> {
<a name="l00169"></a>00169     filename = QFileDialog::getOpenFileName (<span class="keyword">this</span>,
<a name="l00170"></a>00170                                              tr(<span class="stringliteral">&quot;Open file&quot;</span>),
<a name="l00171"></a>00171                                              QDir::homePath(),
<a name="l00172"></a>00172                                              <span class="stringliteral">&quot;Game files (*.pdi)&quot;</span> );
<a name="l00173"></a>00173     <span class="keywordflow">if</span> ( !filename.compare(<span class="stringliteral">&quot;&quot;</span>) ) <span class="keywordflow">return</span>;
<a name="l00174"></a>00174     game_.<a class="code" href="class_game.html#a6f3a33940524b6ba9d83f627ccb14bbf">init</a>();
<a name="l00175"></a>00175     ifstream in;
<a name="l00176"></a>00176     in.exceptions(ios::badbit);
<a name="l00177"></a>00177     in.open( filename.toStdString() );
<a name="l00178"></a>00178     <span class="keywordtype">string</span> s;
<a name="l00179"></a>00179     <span class="keywordflow">while</span> ( in &gt;&gt; s ) {
<a name="l00180"></a>00180       <span class="keywordflow">if</span> ( s == <span class="stringliteral">&quot;numbercompetitors&quot;</span> ) {
<a name="l00181"></a>00181         in &gt;&gt; nCompetitors;
<a name="l00182"></a>00182         <span class="keywordflow">if</span> ( nCompetitors &gt; 10000 || nCompetitors &lt; 1 ) {
<a name="l00183"></a>00183           <span class="keywordflow">throw</span> string( <span class="stringliteral">&quot;Number of competitors invalid.&quot;</span> );
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185         map &lt;string, int&gt; competitors;
<a name="l00186"></a>00186         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; nCompetitors; i++ ) {
<a name="l00187"></a>00187           in &gt;&gt; s;
<a name="l00188"></a>00188           in &gt;&gt; value;
<a name="l00189"></a>00189           competitors[ s ] = value;
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191         game_.<a class="code" href="class_game.html#a4447bfad550c1e60220ef14146a65bf3">setCompetitors</a>( competitors );
<a name="l00192"></a>00192       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s == <span class="stringliteral">&quot;iterations&quot;</span> ) {
<a name="l00193"></a>00193         in &gt;&gt; value;
<a name="l00194"></a>00194         game_.<a class="code" href="class_game.html#a4c460a9eddcae95dce1a256d55a5abbf">setIterations</a>( value );
<a name="l00195"></a>00195       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s == <span class="stringliteral">&quot;randomseed&quot;</span> ) {
<a name="l00196"></a>00196         in &gt;&gt; value;
<a name="l00197"></a>00197         game_.<a class="code" href="class_game.html#a1f9d4bdbcdd4a087be8f01b238afd4fb">setRandomSeed</a>( value );
<a name="l00198"></a>00198       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s == <span class="stringliteral">&quot;updatefrequency&quot;</span> ) {
<a name="l00199"></a>00199         in &gt;&gt; updateFrequency_;
<a name="l00200"></a>00200       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s == <span class="stringliteral">&quot;displaymethodology&quot;</span> ) {
<a name="l00201"></a>00201         in &gt;&gt; value;
<a name="l00202"></a>00202         displayMethodology_ = <a class="code" href="guicommon_8h.html#ab73f4a618a1a86d78e9cc82ff1c376df">DisplayMethodology</a>( value );
<a name="l00203"></a>00203       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s == <span class="stringliteral">&quot;competitorcolors&quot;</span> ) {
<a name="l00204"></a>00204         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; nCompetitors; i++ ) {
<a name="l00205"></a>00205           <span class="keywordtype">string</span> stringColor;
<a name="l00206"></a>00206           in &gt;&gt; s;
<a name="l00207"></a>00207           in &gt;&gt; stringColor;
<a name="l00208"></a>00208           colors_[ QString().fromStdString(s) ] =
<a name="l00209"></a>00209               QColor( QString().fromStdString( stringColor ) );
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s == <span class="stringliteral">&quot;timer&quot;</span> ) {
<a name="l00212"></a>00212         <span class="keywordflow">if</span> ( in &gt;&gt; value ) {
<a name="l00213"></a>00213           timer_ = value;
<a name="l00214"></a>00214         } <span class="keywordflow">else</span> <span class="keywordflow">throw</span> string(<span class="stringliteral">&quot;Invalid value for timer&quot;</span> );
<a name="l00215"></a>00215       } <span class="keywordflow">else</span> <span class="keywordflow">throw</span> string(<span class="stringliteral">&quot;Unknown value: &quot;</span>) + s;
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217     in.close();
<a name="l00218"></a>00218     firstTime_ = <span class="keyword">false</span>;
<a name="l00219"></a>00219     game_.<a class="code" href="class_game.html#a96bab56aca0c477e1541a1c988db0806">shuffleCompetitors</a>();
<a name="l00220"></a>00220     this-&gt;drawGameGrid();
<a name="l00221"></a>00221   } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;s) {
<a name="l00222"></a>00222     QMessageBox msgBox;
<a name="l00223"></a>00223     msgBox.setText( QString().fromStdString(s) );
<a name="l00224"></a>00224     msgBox.exec();
<a name="l00225"></a>00225   } <span class="keywordflow">catch</span> (exception &amp;e) {
<a name="l00226"></a>00226     QMessageBox msgBox;
<a name="l00227"></a>00227     msgBox.setText( QString( tr(<span class="stringliteral">&quot;Error opening or reading from the file: &quot;</span> ) ) +
<a name="l00228"></a>00228                     QString( filename ) + QString(<span class="stringliteral">&quot;\n&quot;</span>) );
<a name="l00229"></a>00229     msgBox.exec();
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="keywordtype">void</span> MainWindow::newGameDialog()
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235   <a class="code" href="class_define_game_dialog.html">DefineGameDialog</a>* dialog = <span class="keyword">new</span> <a class="code" href="class_define_game_dialog.html">DefineGameDialog</a>();
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   dialog-&gt;<a class="code" href="class_define_game_dialog.html#a33728191a5e1eeb299231366a34a7755">setIterations</a>( game_.<a class="code" href="class_game.html#adc07928f26c664cefc2c6abee7846d5e">getIterations</a>() );
<a name="l00238"></a>00238   dialog-&gt;<a class="code" href="class_define_game_dialog.html#ae25df866135fe7bf0b0fbeb07e0afce8">setRandomSeed</a>( game_.<a class="code" href="class_game.html#a6e7fe9dda89a2ab47530fbeac087c8be">getRandomSeed</a>() );
<a name="l00239"></a>00239   dialog-&gt;<a class="code" href="class_define_game_dialog.html#ac3c15aa4373e80a2d1f48e351fbec22d">setUpdateFrequency</a>( updateFrequency_ );
<a name="l00240"></a>00240   dialog-&gt;<a class="code" href="class_define_game_dialog.html#a1f8fb573eed31f5ca51bab1fc95dfd96">setUpdateStyle</a>( displayMethodology_ );
<a name="l00241"></a>00241   dialog-&gt;<a class="code" href="class_define_game_dialog.html#af620552efe0e2745c0597f86b27faa54">setCompetitorColors</a>( colors_ );
<a name="l00242"></a>00242   dialog-&gt;<a class="code" href="class_define_game_dialog.html#ab87cb307a2e7df3db01f011d4ec521f6">setTimer</a>( timer_ );
<a name="l00243"></a>00243   dialog-&gt;<a class="code" href="class_define_game_dialog.html#ae69dba8751b7d1c7a9a37dc93194c940">setCompetitors</a>( game_.<a class="code" href="class_game.html#a658a753770db51eca96fb822d680c338">getNumberCompetitorsPerCompetitor</a>() );
<a name="l00244"></a>00244   <span class="keywordflow">if</span> ( firstTime_ ) {
<a name="l00245"></a>00245     dialog-&gt;<a class="code" href="class_define_game_dialog.html#a744104a9111b8162e8caf0b7407e6a9b">setNumberForAllCompetitors</a>( 1 );
<a name="l00246"></a>00246   }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   <span class="keywordflow">if</span> ( dialog-&gt;exec() ) {
<a name="l00249"></a>00249     <span class="keywordflow">if</span> ( inProgress_ )
<a name="l00250"></a>00250       this-&gt;stopPlaying();
<a name="l00251"></a>00251     <span class="keywordflow">else</span>
<a name="l00252"></a>00252       firstTime_ = <span class="keyword">false</span>;
<a name="l00253"></a>00253     game_.<a class="code" href="class_game.html#a6f3a33940524b6ba9d83f627ccb14bbf">init</a>();
<a name="l00254"></a>00254     game_.<a class="code" href="class_game.html#a4c460a9eddcae95dce1a256d55a5abbf">setIterations</a>( dialog-&gt;<a class="code" href="class_define_game_dialog.html#aab8b573f7013cfc7517604f821846811">getIterations</a>() );
<a name="l00255"></a>00255     game_.<a class="code" href="class_game.html#a1f9d4bdbcdd4a087be8f01b238afd4fb">setRandomSeed</a>( dialog-&gt;<a class="code" href="class_define_game_dialog.html#a92f8df459fdfe50d4970bc720cc49df5">getRandomSeed</a>() );
<a name="l00256"></a>00256     updateFrequency_ = dialog-&gt;<a class="code" href="class_define_game_dialog.html#a7aa948035e602f797fb12cfcf35f1887">getUpdateFrequency</a>();
<a name="l00257"></a>00257     timer_ = dialog-&gt;<a class="code" href="class_define_game_dialog.html#a961536538a0eb16d9c309b1344b5da14">getTimer</a>();
<a name="l00258"></a>00258     displayMethodology_ = (<a class="code" href="guicommon_8h.html#ab73f4a618a1a86d78e9cc82ff1c376df">DisplayMethodology</a>) dialog-&gt;<a class="code" href="class_define_game_dialog.html#ac876a8f37fcbb32d35fc7f5811709acd">getUpdateStyle</a>();
<a name="l00259"></a>00259     game_.<a class="code" href="class_game.html#a4447bfad550c1e60220ef14146a65bf3">setCompetitors</a>( dialog-&gt;<a class="code" href="class_define_game_dialog.html#a01961f0e810461d5d133d9b1414e23ab">getCompetitors</a>() );
<a name="l00260"></a>00260     game_.<a class="code" href="class_game.html#a96bab56aca0c477e1541a1c988db0806">shuffleCompetitors</a>();
<a name="l00261"></a>00261     colors_ = dialog-&gt;<a class="code" href="class_define_game_dialog.html#ae5997315e5d87ff38f075d810575eafe">getCompetitorColors</a>();
<a name="l00262"></a>00262     saveGameAction_-&gt;setDisabled( <span class="keyword">false</span> );
<a name="l00263"></a>00263     drawGameGrid();
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="keywordtype">void</span> MainWindow::executeGame()
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269   inProgress_ = <span class="keyword">true</span>;
<a name="l00270"></a>00270   playAction_-&gt;setDisabled( <span class="keyword">true</span> );
<a name="l00271"></a>00271   setPlayActionToPause( <span class="keyword">true</span> );
<a name="l00272"></a>00272   progressBar_= guiPlay_-&gt;<a class="code" href="class_gui_play.html#aeb3c459efc257be1e8dd8846189fb98c">getProgressBar</a>();
<a name="l00273"></a>00273   this-&gt;statusBar()-&gt;addWidget( progressBar_ );
<a name="l00274"></a>00274   redirectCout();
<a name="l00275"></a>00275   game_.<a class="code" href="class_game.html#ac9ae9f4e5bc37fb20cd29c42058da47e">csvHeader</a>();
<a name="l00276"></a>00276   guiPlay_-&gt;<a class="code" href="class_gui_play.html#a3ee52f6eafb9e770ac3c7c08338de5a0">startPlaying</a>();
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="keywordtype">void</span> MainWindow::redirectCout()
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281   coutBackup_ = cout.rdbuf();
<a name="l00282"></a>00282   outputFile_.open(<span class="stringliteral">&quot;prisonerslog.csv&quot;</span>);
<a name="l00283"></a>00283   outputBuffer_= outputFile_.rdbuf();
<a name="l00284"></a>00284   cout.rdbuf( outputBuffer_ );
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="keywordtype">void</span> MainWindow::resetCout()
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289   cout.rdbuf( coutBackup_ );
<a name="l00290"></a>00290   outputFile_.close();
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="keywordtype">void</span> MainWindow::pauseGame()
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295   <span class="keywordflow">if</span> ( guiPlay_ ) {
<a name="l00296"></a>00296     <span class="keywordflow">if</span> ( guiPlay_-&gt;<a class="code" href="class_gui_play.html#ae67f437ee24b0bc1758e2176b9c119d5">isPaused</a>() ) {
<a name="l00297"></a>00297       setPlayActionToPause( <span class="keyword">true</span> );
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299     <span class="keywordflow">else</span> {
<a name="l00300"></a>00300       setPlayActionToPlay( <span class="keyword">true</span> );
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     emit guiPlay_-&gt;<a class="code" href="class_gui_play.html#a28ceab1b46e252e30c9f7858450b0de9">pausePlaying</a>();
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="keywordtype">void</span> MainWindow::stopPlaying()
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309   inProgress_ = <span class="keyword">false</span>;
<a name="l00310"></a>00310   statusBar()-&gt;removeWidget( progressBar_ );
<a name="l00311"></a>00311   QString s = tr(<span class="stringliteral">&quot;Game finished after &quot;</span>) +
<a name="l00312"></a>00312       QString().setNum( game_.<a class="code" href="class_game.html#adc07928f26c664cefc2c6abee7846d5e">getIterations</a>() ) + tr( <span class="stringliteral">&quot; iterations.&quot;</span> );
<a name="l00313"></a>00313   statusBar()-&gt;showMessage( s );
<a name="l00314"></a>00314   setPlayActionToPlay( <span class="keyword">false</span>);
<a name="l00315"></a>00315   game_.<a class="code" href="class_game.html#ad4fb8a857ddf279726b13acc0f6d6235">output</a>();
<a name="l00316"></a>00316   resetCout();
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="keywordtype">void</span> MainWindow::setPlayActionToPlay( <span class="keywordtype">bool</span> enabled )
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321   playAction_-&gt;setIcon( *playIcon_ );
<a name="l00322"></a>00322   playAction_-&gt;setText( <span class="stringliteral">&quot;&amp;Play&quot;</span> );
<a name="l00323"></a>00323   playAction_-&gt;setEnabled( enabled );
<a name="l00324"></a>00324   playAction_-&gt;disconnect();
<a name="l00325"></a>00325   <span class="keywordflow">if</span> ( inProgress_ )
<a name="l00326"></a>00326     connect( playAction_, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(pauseGame()) );
<a name="l00327"></a>00327   <span class="keywordflow">else</span>
<a name="l00328"></a>00328     connect( playAction_, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(executeGame()) );
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 <span class="keywordtype">void</span> MainWindow::setPlayActionToPause( <span class="keywordtype">bool</span> enabled )
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333   playAction_-&gt;setIcon( *pauseIcon_ );
<a name="l00334"></a>00334   playAction_-&gt;setText( <span class="stringliteral">&quot;&amp;Pause&quot;</span> );
<a name="l00335"></a>00335   playAction_-&gt;setEnabled( enabled );
<a name="l00336"></a>00336   playAction_-&gt;disconnect();
<a name="l00337"></a>00337   connect( playAction_, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(pauseGame()) );
<a name="l00338"></a>00338 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="mainwindow_8cpp.html">mainwindow.cpp</a>      </li>
      <li class="footer">Generated on Sat Mar 31 2012 10:40:25 for Prisoner's Dilemna by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
